<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="utf-8">

	<!-- Force latest available IE rendering engine and Chrome Frame (if installed) -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Timezones</title>
	<meta name="description" content="A simple timezone converter">

	<!-- Mobile Screen Resizing -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Icons: place in the root directory -->
	<!-- https://github.com/audreyr/favicon-cheat-sheet -->
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="icon" sizes="16x16 32x32" href="favicon.ico">

	<style type="text/css">
		button,hr{overflow:visible}[tabindex="-1"]:focus,a:active{outline:0}@-ms-viewport{width:device-width;zoom:1}@-o-viewport{width:device-width;zoom:1}@viewport{width:device-width;zoom:1}.link-block-styled,a,button,input,label,select,summary,textarea{-ms-touch-action:manipulation;touch-action:manipulation}*,:after,:before{box-sizing:border-box}html{overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}body{margin:0;background:#fff;color:#272727;font-family:"Helvetica Neue",Arial,sans-serif;font-size:100%;line-height:1.5}article,aside,cite,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}img,video{max-width:100%;height:auto}img{border-style:none;-ms-interpolation-mode:bicubic}svg:not(:root){overflow:hidden}.container{margin-left:auto;margin-right:auto;max-width:44em;width:88%}.row{margin-left:-1.4%;margin-right:-1.4%}.grid-dynamic,.grid-fifth,.grid-four-fifths,.grid-fourth,.grid-full,.grid-half,.grid-third,.grid-three-fifths,.grid-three-fourths,.grid-two-fifths,.grid-two-thirds{float:left;padding-left:1.4%;padding-right:1.4%;width:100%}.grid-flip{float:right}@media (min-width:40em){.grid-fifth{width:20%}.grid-fourth{width:25%}.grid-third{width:33.33333%}.grid-two-fifths{width:40%}.grid-half{width:50%}.grid-three-fifths{width:60%}.grid-two-thirds{width:66.66667%}.grid-three-fourths{width:75%}.grid-four-fifths{width:40%}.grid-full{width:100%}.offset-fourth{margin-left:25%}.offset-third{margin-left:33.33333%}.offset-half{margin-left:50%}.offset-two-thirds{margin-left:66.66667%}.offset-three-fourths{margin-left:75%}.offset-full{margin-left:100%}body{line-height:1.5625}}p{margin:0 0 1.5625em}.link-block-styled,a{background-color:transparent;color:#08c;text-decoration:none;-webkit-text-decoration-skip:objects;text-decoration-skip:objects;word-wrap:break-word}a:active,a:focus,a:hover{color:#005580;text-decoration:underline}ol,ul{margin:0 0 1.5625em 2em;padding:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dd,dl{margin:0;padding:0}dd,fieldset,form{margin-bottom:1.5625em}dt{font-weight:700}.list-unstyled{margin-left:0;list-style:none}.list-inline{list-style:none;margin-left:-.5em;margin-right:-.5em;padding:0}.list-inline>li{display:inline;margin-left:.5em;margin-right:.5em}h1,h2,h3,h4,h5,h6{font-weight:400;line-height:1.2;margin:0 0 1em;padding:1em 0 0;word-wrap:break-word}.h1,h1{font-size:1.5em;padding-top:.5em}@media (min-width:40em){.h1,h1{font-size:1.75em}}.h2,h2{font-size:1.3125em}.h3,h3{font-size:1.1875em}.h4,.h5,.h6,h4,h5,h6{font-size:1em}.h4,h4{text-transform:uppercase}hr{border:0;border-top:1px solid #e5e5e5;border-bottom:0 solid transparent;box-sizing:content-box;margin:2em auto}b,strong{font-weight:bolder}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}dfn{font-style:italic}mark{background:#fbf89a;color:#272727}fieldset{border:0;padding:0}label,legend{display:block;font-weight:400;margin:0 0 .3125em;padding:0}button,input,optgroup,select,textarea{color:#555;font:inherit;margin:0;padding:.3125em}form .button,form button,input,select,textarea{margin-bottom:1.1875em}button,select{text-transform:none}input,select,textarea{border:1px solid #b8b8b8;border-radius:1px;display:block;line-height:1.5;width:100%}@media (min-width:40em){input,select,textarea{line-height:1.5625}}optgroup{font-weight:700}textarea{height:12em;overflow:auto}[type=image],[type=checkbox],[type=radio]{cursor:pointer;display:inline-block;height:auto;margin-bottom:.3125em;padding:0;width:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}input:focus,textarea:focus{border-color:rgba(82,168,236,.8);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 .5em rgba(82,168,236,.6);outline:0;outline:dotted thin\9}[type=checkbox]:focus,[type=file]:focus,select:focus{outline:dotted thin;outline:-webkit-focus-ring-color auto .3125em;outline-offset:-.125em}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}.input-inline{display:inline-block;vertical-align:middle;width:auto}.input-condensed{padding:1px .3125em;font-size:.9375em}.timezone{border-top:1px solid #e5e5e5;margin:0 -8px;padding:8px}.timezone:first-child{border-top:none}.timezone.local{background-color:#f7f7f7}.text-small{font-size:.9375em}.text-large{font-size:1.1875em;line-height:1.4}.text-muted{color:grey}.text-info{color:#08c}.text-warning{color:red}.text-center{text-align:center}.text-right{text-align:right}.text-left{text-align:left}@media (min-width:40em){.text-large{font-size:1.3125em}.text-right-medium{text-align:right}}.float-left{float:left}.float-center{float:none;margin-left:auto;margin-right:auto}.float-right{float:right}.no-margin-top{margin-top:0}.no-margin-bottom{margin-bottom:0}.margin-top{margin-top:1.5625em}.margin-bottom{margin-bottom:1.5625em}.margin-bottom-small{margin-bottom:.5em}.margin-bottom-large{margin-bottom:2em}.margin-right{margin-right:.3125em}.margin-left{margin-left:.3125em}.no-padding-top{padding-top:0}.no-padding-bottom{padding-bottom:0}.padding-top{padding-top:1.5625em}.padding-top-small{padding-top:.5em}.padding-top-large{padding-top:2em}.padding-bottom{padding-bottom:1.5625em}.padding-bottom-small{padding-bottom:.5em}.padding-bottom-large{padding-bottom:2em}.screen-reader,.svg .icon-fallback-text{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}.screen-reader-focusable:active,.screen-reader-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;white-space:normal;width:auto}[hidden],template{display:none;visibility:hidden}.clearfix:after,.clearfix:before,.container:after,.container:before,.row:after,.row:before{display:table;content:" "}.clearfix:after,.container:after,.row:after{clear:both}@media print{blockquote,img,pre,tr{page-break-inside:avoid}*{background:0 0!important;color:#000!important;box-shadow:none!important;text-shadow:none!important}@page{margin:.5cm}.link-block-styled,.link-block-styled:visited,a,a:visited{text-decoration:underline}[href].link-block-styled:after,a[href]:after{content:" (" attr(href) ")"}[href^="#"].link-block-styled:after,a[href^="#"]:after{content:""}h1,h2,h3,p{orphans:3;widows:3}h1,h2,h3{page-break-after:avoid}blockquote,pre{border-color:#999}thead{display:table-header-group}}
	</style>
</head>
<body>

	<main id="main" class="container">

		<h1 class="no-margin-bottom">Timezones</h1>
		<p>Easily calculate timezones for your next meeting.</p>

		<div id="app"></div>

	</main>


	<script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
	<script>
		// @todo
		// 1. Add UTC offset info
		// 2. Allow timezones to be hidden
		// 3. Create deep-linking functionality
		// 4. Add a date picker

		;(function (window, document, undefined) {

			'use strict';

			//
			// Variables
			//

			// Timezone Data
			var data = [
				{
					name: 'Hawaiian',
					cities: ['Honolulu'],
					locale: 'Pacific/Honolulu',
					active: false
				},
				{
					name: 'Alaska',
					cities: ['Fairbanks', 'Anchorage'],
					locale: 'America/Anchorage',
					active: false
				},
				{
					name: 'US Pacific',
					cities: ['Seattle', 'San Francisco', 'Palo Alto'],
					locale: 'America/Los_Angeles',
					active: true
				},
				{
					name: 'US Mountain',
					cities: ['Salt Lake City', 'Denver'],
					locale: 'America/Denver',
					active: true
				},
				{
					name: 'US Central',
					cities: ['Chicago', 'Houston', 'Dallas', 'Austin'],
					locale: 'America/Chicago',
					active: true
				},
				{
					name: 'US Eastern',
					cities: ['Boston', 'New York', 'Miami'],
					locale: 'America/New_York',
					active: true
				},
				{
					name: 'Greenwich Mean Time',
					cities: ['GMT'],
					locale: 'UTC',
					active: true
				},
				{
					name: 'United Kingdom',
					cities: ['Dublin', 'London', 'Cardif'],
					locale: 'Europe/London',
					active: true
				},
				{
					name: 'Central European',
					cities: ['Oslo', 'Stockholm', 'Paris', 'Amersterdam', 'Madrid', 'Barcelona', 'Rome'],
					locale: 'Europe/Rome',
					active: true
				},
				{
					name: 'Eastern European',
					cities: ['Helsinki', 'Sofia', 'Athens', 'Cairo'],
					locale: 'Europe/Athens',
					active: true
				},
				{
					name: 'Central African',
					cities: ['Johannesburg', 'Cape Town'],
					locale: 'Africa/Johannesburg',
					active: true
				},
				{
					name: 'Moscow',
					cities: ['Moscow', 'Minsk'],
					locale: 'Europe/Moscow',
					active: false
				},
				{
					name: 'Indian',
					cities: ['Mumbai', 'Bangalore', 'Pune'],
					locale: 'Asia/Kolkata',
					active: true
				},
				{
					name: 'IndoChina',
					cities: ['Singapore'],
					locale: 'Asia/Singapore',
					active: true
				},
				{
					name: 'China',
					cities: ['Beijing', 'Shanghai'],
					locale: 'Asia/Shanghai',
					active: true
				},
				{
					name: 'Hong Kong',
					cities: ['Hong Kong'],
					locale: 'Asia/Hong_Kong',
					active: false
				},
				{
					name: 'Japan',
					cities: ['Tokyo'],
					locale: 'Asia/Tokyo',
					active: true
				},
				{
					name: 'Eastern Australia',
					cities: ['Sydney', 'Melbourne'],
					locale: 'Australia/Sydney',
					active: true
				},
				{
					name: 'Eastern Autralia - Queensland',
					cities: ['Cairns', 'Brisbane'],
					locale: 'Australia/Brisbane',
					active: true
				},
				{
					name: 'Western Australia',
					cities: ['Perth'],
					locale: 'Australia/Perth',
					active: true
				},
				{
					name: 'New Zealand',
					cities: ['Auckland', 'Wellington'],
					locale: 'Pacific/Auckland',
					active: true
				}
			];


			//
			// Methods
			//

			/**
			 * Convert minutes into hours and minutes
			 * @param  {Integer} shift Offset in minutes
			 * @return {Object}        Offset in hours and minutes
			 */
			var convertMinutes = function (shift) {
				var minutes = shift % 60;
				var hours = (shift - minutes) / 60;
				return {
					hours: hours,
					minutes: minutes
				};
			};

			/**
			 * Get the standard UTC offset time for a location
			 * @param  {Object}  date The Date() object
			 * @return {Integer} The standard UTC offset
			 */
			var getStandardTimezoneOffset = function (date) {
				var year = date.getFullYear();
				var jan = new Date(year, 0, 1);
				var jul = new Date(year, 6, 1);
				return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());
			};

			/**
			 * Get the timezone UTC offset in hours
			 * @param  {Object} date The Date() object
			 * @return {Number}      The UTC offset in hours
			 */
			var getOffset = function (date) {
				return getStandardTimezoneOffset(date) / -60;
			};

			/**
			 * Check if DST is currently observed
			 * @param  {Object} date The Date() object
			 * @return {Boolean}     If true, it's currently DST in this locale
			 */
			var isDSTObserved = function (date) {
				return date.getTimezoneOffset() < getStandardTimezoneOffset(date);
			};

			/**
			 * Get the current time rounded up to nearest half hour
			 * @param  {Object} date The date
			 * @return {Object}      The date rounded up to nearest half hour
			 */
			var getCurrentTime = function (date) {
				var minutes = date.getMinutes() > 30 ? 0 : 30;
				date.setMinutes(minutes);
				if (minutes === 0) {
					date.setHours(date.getHours() + 1);
				}
				return date;
			};

			/**
			 * Get the difference in time between the user's location and a particular locale
			 * @param  {Object} date   The date object for the current user
			 * @param  {String} locale The locale to compare the user's location to
			 * @return {Integer}       The difference in minutes between the user's location and the locale
			 */
			var getTimeShift = function (date, locale) {
				var time = new Date(date.toLocaleString('en-US', {timeZone: locale})).getTime();
				var shift = (date.getTime() - time) / 60 / 1000;
				return Math.floor(shift);
			};

			/**
			 * Get the local time from the Date object
			 * @param  {Object} date  The date object to get the time from
			 * @return {String}       The local time for the user
			 */
			var getLocalTime = function (date) {
				return date.toLocaleTimeString('en-US', {hour12: false, hour: '2-digit', minute: '2-digit'});
			};

			/**
			 * Get the time in a particular locale
			 * @param  {Object} date   The date object to adjust for a locale
			 * @param  {String} locale The locale to get the time in
			 * @return {String}        The time in a particular locale
			 */
			var getTime = function (date, locale) {
				return date.toLocaleTimeString('en-US', {timeZone: locale, hour12: false, hour: '2-digit', minute: '2-digit'});
			};

			/**
			 * [getGMTOffset description]
			 * @todo
			 * @param  {[type]} date   [description]
			 * @param  {[type]} locale [description]
			 * @return {[type]}        [description]
			 */
			var getGMTOffset = function (date, locale) {
				var current = new Date(date.toLocaleString('en-US', {timeZone: locale})).getTime();
				var gmt = new Date(date.toLocaleString('en-US', {timeZone: 'UTC'})).getTime();
				var shift = (current - gmt) / 60 / 1000 / 60;
				return Math.floor(shift);
			}

			/**
			 * Get a date in a particular locale
			 * @param  {Object} date   The date object to adjust for a locale
			 * @param  {String} locale The locale to get the date in
			 * @return {String}        The date in a particular locale
			 */
			var getDate = function (date, locale) {
				return new Date(date.toLocaleString('en-US', {timeZone: locale})).getDate();
			};

			/**
			 * Get the "day relative to yours" message
			 * @param  {Integer}  day      The day for the user
			 * @param  {Integer}  localDay The day for a specific locale
			 * @param  {Boolean}  isLocal  If true, the locale is the current user's
			 * @return {String}            The message
			 */
			var getDateMessage = function (day, localDay, isLocal) {
				if (isLocal) {
					return '<strong>This is you.</strong>';
				}

				if (localDay < day) {
					return '<span class="text-warning">The <strong>day before</strong> their time.</span>';
				}

				if (localDay > day) {
					return '<span class="text-warning">The <strong>day after</strong> their time.</span>';
				}

				return '<span class="text-info">Same day as you.</span>';
			};

			/**
			 * Adds a message about the time of local relative to the user's
			 * @param {Object} date     The date object for the user
			 * @param {String} locale   The locale
			 * @param {Node}   timezone The node for the current locale
			 */
			var setDateMessage = function (date, locale, timezone) {
				var msg = timezone.closest('.timezone').querySelector('[data-type="date"]');
				if (!msg) return;
				msg.innerHTML = getDateMessage(date.getDate(), getDate(date, locale), timezone.matches('.local'));
			};

			/**
			 * Set times for each timezone
			 * @param {Object}   date      The date object for the user
			 * @param {NodeList} timezones The timezones
			 */
			var setTimes = function (date, timezones) {
				timezones.forEach(function (timezone) {
					var select = timezone.querySelector('[data-type="time"]');
					var locale = select.getAttribute('data-locale');
					var dateMessage;
					select.value = getTime(date, locale);
					setDateMessage(date, locale, timezone);
				});
			};

			/**
			 * Adding a leading zero to single digit times
			 * @param  {Integer} num The time
			 * @return {String}      The time with leading zero
			 */
			var padStart = function (num) {
				num = num.toString();
				return num.length < 2 ? '0' + num : num;
			};

			// @todo
			var renderTimeOptions = function (current) {
				var ante = ['am', 'pm'];
				var hours = [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
				var minutes = ['00', '30'];
				var times = '';
				ante.forEach(function (a) {
					hours.forEach(function (hour) {
						minutes.forEach(function (min) {
							var time = padStart(a === 'pm' && hour !== 12 ? hour + 12 : (a === 'am' && hour === 12 ? '00' : hour))  + ':' + min;
							times += '<option value="' + padStart(time) + '"' + (time === current ? ' selected' : '') + '>' + hour + ':' + min + ' ' + a + '</option>';
						});
					});
				});
				return times;
			};

			var renderTimezone = function (date, timezone, index) {
				var current = getTime(date, timezone.locale);
				var isLocal = getLocalTime(date) === current;
				var timeShift = getTimeShift(date, timezone.locale);
				var timeShiftHours = Math.abs(timeShift/60);
				var gmtOffset = getGMTOffset(date, timezone.locale);
				var content =
					'<div class="timezone' + (isLocal ? ' local' : '') + '">' +
						'<h2 class="no-padding-top no-margin-bottom">' + timezone.name + '</h2>' +
						'<div class="row">' +
							'<div class="grid-two-fifths margin-bottom-small">' +
								'<span class="text-muted text-small" data-type="cities">' + timezone.cities.join(', ') + '</span><br>' +
								'<em class="text-muted text-small" data-type="meta">' +
									'GMT' + (gmtOffset < 0 ? '' : '+') + gmtOffset +
									' | ' +
									(isLocal ? '<span style="color:red;">Your Timezone</span>' : timeShiftHours + (timeShiftHours <= 1 ? ' hour ' : ' hours ') + (timeShift < 0 ? 'after' : 'before') + ' you') +
								'</em>' +
							'</div>' +
							'<div class="grid-fifth" data-type="times">' +
								'<label class="screen-reader" for="time-' + index + '">Time in ' + timezone.name + '</label>' +
								'<select class="margin-bottom-small" data-type="time" data-locale="' + timezone.locale + '" data-time-shift="' + timeShift + '" id="time-' + index + '">' +
									renderTimeOptions(current) +
								'</select>' +
							'</div>' +
							'<div class="grid-two-fifths margin-bottom-small" data-type="date">' +
								getDateMessage(date.getDate(), getDate(date, timezone.locale), isLocal) +
							'</div>' +
						'</div>' +
					'</div>';

				return content;
			};

			var renderApp = function (date) {
				var app = document.querySelector('#app');
				var content = '';
				data.forEach(function (timezone, index) {
					if (!timezone.active) return;
					content += renderTimezone(date, timezone, index);
				});
				app.innerHTML = content;
			};

			var handleTimechange = function (event) {

				if (!event.target.matches('[data-type="time"]')) return;

				var time = new Date();
				var selected = event.target.value.split(':');
				var shift = convertMinutes(event.target.getAttribute('data-time-shift'));
				var timezones = Array.from(document.querySelectorAll('.timezone'));

				time.setHours(parseInt(selected[0], 10) + shift.hours, parseInt(selected[1], 10) + shift.minutes, '00');

				setTimes(time, timezones);

			};


			//
			// Inits & Event Listeners
			//

			var date = getCurrentTime(new Date());

			// Render the app
			renderApp(date);

			// Detect time changes
			document.addEventListener('change', handleTimechange, false);

			// Update the time every 15 minutes
			window.setTimeout(function () {
				date = getCurrentTime(new Date());
			}, 1000 * 60 * 15);

		})(window, document);
	</script>
</body>
</html>